# Как работать с формами

Формы создаются с помощью класса `\Wdpro\Form\Form`

## Php и js

Формы можно создавать как в php, так и в js.

По-сути формы всегда создаются с помощью js. Просто когда мы их создаем в php, их настройки отправляются в js.

Поэтому ими можно пользоваться и в js и в php.

## Как создать форму в админке

В кратце

1. Создаем класс формы
2. Добавляем поля

### Создаем класс

Для этого в папке модуля создаем файл **ConsoleForm.php**:

```php
<?php
namespace App\Catalog;

class ConsoleForm extends \App\BaseForm {

}
```

### Добавляем поля

```php
<?php
namespace App\Catalog;

class ConsoleForm extends \App\BaseForm {

	protected function initFields() {

		// Поле картинки
		$this->add([
			'name'=>'image',
			'left'=>'Картинка',
			'type'=>static::IMAGE,
			'*'=>true,
		]);

		// Поле описания
		$this->add([
			'name'=>'text',
			'left'=>'Описание',
		]);

		// Поле сортировки
		$this->add(static::SORTING);

		// Кнопка Сохранить
		$this->add(static::SUBMIT_SAVE);
	}

}
```

Названия полей формы должны совпадать с названиями полей mysql таблицы.

Чтобы форма появилась в админке и начала работать, надо еще сделать список ConsoleRoll. Об этом смотрите в одной из следующих инструкций.



## Как создать форму на сайте

В кратце:

1. Создаем класс формы
2. Добавляем поля
3. Размещаем на сайте
4. Обрабатываем отправку



### Создаем класс формы

Для этого можно в папке с модулем создать любой файл. Например, **Form.php**:

```php
<?php
namespace App\Catalog;

class Form extends \App\BaseForm {

}
```



### Добавляем поля

```php
<?php
namespace App\Catalog;

class Form extends \App\BaseForm {

	protected function initFields()
	{
		$this->add([
			'name' => 'email',
			'center' => 'Ваш e-mail',
			'*' => true,
		]);

		$this->add([
			'name' => 'name',
			'center' => 'Ваше имя',
			'*' => true,
		]);

		$this->add([
			'name' => 'message',
			'center' => 'Сообщение',
			'type' => static::TEXT,
			'*' => true,
		]);

		$this->add([
			'type' => static::SUBMIT,
			'value' => 'Отправить',
		]);
	}

}
```



### Размещаем на сайте

Например, в контроллере в методе runSite с помощью шорткода ловим место, куда ставить форму. 

И дальше создаем объект формы и возвращаем html код формы.

```php
public static function runSite()
{
    // Ловим шорткод
    add_shortcode(
        'application_form',
        function () {

            // Создаем объект формы
            $form = new Form();

            // Возвращаем шорткоду html код формы
            return $form->getHtml();
        }
    );
}
```



### Обрабатываем отправку

С помощью метода **onSubmit** ловим отправку формы пользователем.

А с помощью метода **sendToAdmins** отправляем данные формы администраторам.

```php
public static function runSite()
{
    // Ловим шорткод
    add_shortcode(
        'application_form',
        function () {

            // Создаем объект формы
            $form = new Form();

            // Ловим отправку формы
            $form->onSubmit(function ($data) use (&$form) {

                // Отправляем письмо админам с данными формы
                $form->sendToAdmins('Форма каталога');

            });

            // Возвращаем шорткоду html код формы
            return $form->getHtml();
        }
    );
}
```



## Поля формы

### Обычное поле

```php
$this->add([
    'name'=>'name',
    'center'=>'Ваше имя',
    '*'=>1,
    'autoWidth'=>false,
    'autoLeft'=>false,
]);
```

Где:

##### name

Название поля. Должно совпадать с именем поля mysql таблицы, когда это форма в админке.

##### center (left, right, top, bottom)

Подписи к полю.

* center - над полем
* left - слева от поля
* top - над полем
* right - справа от поля

##### \* (звездочка)

Делает поле обязательным

##### autoWidth

По-умолчанию форма выравнивает поля (делает их одинаковой ширины). Указав в этом параметре false можно отключить эту функцию для этого поля.

##### autoLeft

По-умолчанию форма выравнивает описания полей (которые слева). Указав в этом параметре false можно отключить эту функцию для этого поля.



### Checkbox

```php
$this->add([
    'name'=>'yes',
    'right'=>'Да',
    'type'=>static::CHECK,
    'checked'=>true,
]);
```

Где:

##### checked

Когда true, то галочка по-умолчанию стоит.



### Дата

```php
$this->add([
 'name'=>'date',
 'left'=>'Дата',
 'type'=>static::DATE,
]);
```



### Загрузка файла

```php
$this->add([
    'name'=>'pdf',
    'left'=>'PDF файл',
    'type'=>static::FILE,
    'dir'=>wdpro_upload_dir('files'),
    'ext'=>'pdf|zip|rar',
    'multiple'=>true,
]);
```

Где:

##### dir

Папка, куда сохранить файл

##### ext

Расширения файлов

##### multiple

Возможность загружать несколько файлов. Если это админка, то у поля таблицы должен быть тип `json`.



### Скрытое поле

```php
$this->add([
    'name'=>'something',
    'value'=>'1',
    'type'=>static::HIDDEN,
]);
```



### Html

Это не поле. Это элемент, с помощью которого между полями можно добавлять html код.

```php
$this->add([
    'type'=>static::HTML,
    'html'=>'<h2>Заголовок</h2>',
]);
```



### Картинка

```php
$this->add([
    'type' => static::IMAGE,
    'name' => 'image',
    'left' => 'Картинка',
    'resize' => [

        // Первая уменьшенная картинка
        [
            'width' => 263,
            'height' => 197,
            'type' => 'crop',
            'dir' => 'lit'
        ],

        // Вторая уменьшенная картинка
        [
            'width' => 800
        ]
    ],
]);
```

Где:

##### resize

Делает из загружаемой картинки уменьшенные копии.

* width - ширина
* height - высота
* type - когда crop, то обрезает лишнее, чтобы получился ровно такой размер, который задан
* dir - есть общая папка с загружаемыми рисунками, адрес которой находится в константе WDPRO_UPLOAD_IMAGES_URL. Так вот, здесь мы указываем подпапку в этой папке. Если укажем lit, то url папки, куда сохранится уменьшенное изображение будет WDPRO_UPLOAD_IMAGES_URL."/lit/". Это нужно, чтобы разные уменьшенные копии картинок с одинаковым названием лежали в разных папках.



### Выпадающее меню

```php
$this->add([
    'name'=>'country_id',
    'left'=>'Выберите страну',
    'type'=>static::SELECT,
    'options'=>[
        ['ru', 'Россия'],
        ['us', 'США'],
        ['th', 'Тайланд'],
    ],
    'mutiple'=>true,
]);
```

Или

```php
$this->add([
    'name'=>'country_id',
    'left'=>'Выберите страну',
    'type'=>static::SELECT,
    'options'=>[
        'ru'=>'Россия',
        'us'=>'США',
        'th'=>'Тайланд',
    ]
    'mutiple'=>true,
]);
```

Где:

##### options

Список элементов (options).

##### mutiple

Когда true, можно выбрать несколько. Тогда если это сохраняется в базе, у поля должен быть тип `json`.



### Кнопка отправки

```php
$this->add([
    'type' => static::SUBMIT,
    'value' => 'Отправить',
]);
```



### Текст в несколько строк

```php
$this->add([
    'name' => 'message',
    'center' => 'Сообщение',
    'type' => static::TEXT,
]);
```

