# Корзина товаров

## Модификации

Можно сделать, чтобы в корзину можно было положить:

* Обычный товар
* Модификацию товар (определенного размера, цвета)

У разных модификаций могут быть разные цены.

Модификации основаны на ключах. Подробнее про ключи смотрите в файле [23. Ключи объектов.md](https://github.com/mavlutovr/wordpressmvc/blob/master/Wiki/23.%20%D0%9A%D0%BB%D1%8E%D1%87%D0%B8%20%D0%BE%D0%B1%D1%8A%D0%B5%D0%BA%D1%82%D0%BE%D0%B2.md)

## Класс товара

Entity.php

```php
<?php
namespace App\Catalog;

/**
 * Основная сущность модуля
 */
class Entity extends \App\BasePage implements \Wdpro\Cart\CartElementInterface {
    
    
    /**
	 * Возвращает стоимость товара за одну единицу
	 *
	 * @param null|string $key Ключ объекта товара.
	 *    В котором может содержаться помимо информации для получения самого объекта товара,
	 *    дополнительная информация, такая как цвет, размер и тд.
	 *
	 * @return float
	 */
	public function getCost($key = null): float
	{
		if ($key) {
			$key = wdpro_key_parse($key);
		}

		else {
			$key = $this->getKeyArray();
		}

		return $this->getCostForSize($key['object']['size']);
	}
    
    
    /**
	 * Возвращает данные для кнопки "Добавить в корзину"
	 *
	 * @param string|array $entityKey Ключ товара с дополнительной информацией, такой как цвет, размер и тп.
	 * @return array
	 */
	public function getDataForCartButton($entityKey)
	{
		$data = $this->getData();

        // Стоимость именно этой модификации
		$data['cost'] = $this->getCost($entityKey);

		return $data;
	}
}
```



## Кнопка "Добавить в корзину"

Кнопку можно получить с помощью метода 

```php
\Wdpro\Cart\Controller::getAddToCartButton(
    $catalogEntity, // Объект товара
    $catalogModKey // Ключ товара с модификацией
);
```

Когда у товара есть модификации:

```php
<?php
namespace App\Catalog;

/**
 * Основная сущность модуля
 */
class Entity extends \App\BasePage implements \Wdpro\Cart\CartElementInterface {
    
	/**
	 * Обработка данных для шаблона
	 *
	 * @param array $data Необработанные данные
	 * @return array Обработанные данные
	 */
    public function prepareDataForTemplate($data)
	{
		$data['cart_buttons'] = [];
		if (is_array($data['sizes'])) {
			foreach ($data['sizes'] as $size) {
				$key = $this->getKey([ 'size' => $size['size'] ]);
				$data['cart_buttons'][] = \Wdpro\Cart\Controller::getAddToCartButton($this, $key);
			}
		}

		return $data;
	}
```



## Шаблон кнопки "В корзину"

В файле cart_add_button.php. Он создается автоматически.

#### Кнопки

```php
<button class="js-cart-control-button" data-delta="-100">-</button>
```

* data-delta - Сколько прибавлять (убавлять) за нажатие

#### Поле с количеством товаров

Которое отображает количество товара в корзине

```php
<input type="text" data-min="100" class="js-cart-control-count wdpro-form-input" value="<?=($data['added']['count']) ? $data['added']['count'] : '0'?>" inputmode="numeric">
```

* data-min - Минимальное количество товара в корзине



## Сводная информация корзины

```javascript
wdpro.on('cart_info', function (info) {
    // Сводные данные корзины
    console.log(info);
});
```

```php
$info = \Wdpro\Cart\Controller::getInfoData();
print_r($info); // Сводные данные корзины
```



